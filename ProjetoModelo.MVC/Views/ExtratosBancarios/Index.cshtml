@model IEnumerable<ExtratoBancarioViewModel>
@using Moneta.Application.ViewModels

@{
    ViewBag.Title = "Extrato Bancário";
}

<h2>@ViewBag.Title</h2>

<p>
    <a class="btn btn-default" title="Importar OFX"
       href="@Url.Action("ImportarOfx", "ExtratosBancarios")">
        <i class="icon-white glyphicon glyphicon-import"></i>
    </a>

    <a id="botaoRemoverSelecionados" class="btn btn-default" title="Remover itens selecionados"
       href="javascript:validarSeExisteSelecionados()">
        <i class="icon-white glyphicon glyphicon-trash"></i>
    </a>
</p>

@using (Html.BeginForm("RemoverSelecionados", "ExtratosBancarios", FormMethod.Post, new { id = "formExtratos" }))
{
    @Html.AntiForgeryToken()
    
    <table class="table table-striped table-condensed">
        <tr>
            <th>
                @Html.CheckBox("selecionarTodos", false, new { @title = "Selecionar todos" })
            </th>
            <th>
                @Html.DisplayNameFor(model => model.DataCompensacao)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Descricao)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.NumeroDocumento)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Valor)
            </th>
            <th>
                Ações
            </th>
        </tr>

        @{var extratos = Model.ToList();}
        @for(int i = 0; i < Model.Count(); i++)
        {
            <tr>
                <td>
                    @if (extratos[i].Lancamento == null)
                    {
                        @Html.CheckBoxFor(x => extratos[i].Selecionado)
                        @Html.HiddenFor(x => extratos[i].ExtratoBancarioId)
                    }
                </td>
                <td>
                    @Html.DisplayFor(x => extratos[i].DataCompensacao)
                    @Html.HiddenFor(x => extratos[i].DataCompensacao)
                </td>
                <td>
                    @Html.DisplayFor(x => extratos[i].Descricao)
                    @Html.HiddenFor(x => extratos[i].Descricao)
                </td>
                <td>
                    @Html.DisplayFor(x => extratos[i].NumeroDocumento)
                    @Html.HiddenFor(x => extratos[i].NumeroDocumento)
                </td>
                <td>
                    @if (extratos[i].Valor > 0)
                    {
                        <span style="color:green">
                            @Html.DisplayFor(x => extratos[i].Valor)
                        </span>
                    }
                    else
                    {
                        <span style="color:red">
                            @Html.DisplayFor(x => extratos[i].Valor)
                        </span>
                    }               
                </td>
                <td>
                    @if (extratos[i].Lancamento == null)
                    {
                        <a title="Conciliar com um lançamento"
                           href="@Url.Action("Conciliar", "ExtratosBancarios", new { id = extratos[i].ExtratoBancarioId })">
                            <i class="icon-white glyphicon glyphicon-link"></i>
                        </a>
                        <a title="Criar um lançamento a partir deste"
                           href="@Url.Action("CriarLancamento", "ExtratosBancarios", new { id = extratos[i].ExtratoBancarioId })">
                            <i class="icon-white glyphicon glyphicon-new-window"></i>
                        </a>
                    }
                </td>
            </tr>
        }
    </table>
}

@section Scripts {
    <script type="text/javascript">

        function validarSeExisteSelecionados()
        {
            var numberChecked = $('input:checkbox:checked').length;
            if (numberChecked == 0)
            {
                alert("Selecione pelo menos um item");
            }
            else
            {
                if(confirm("Deseja realmente continuar com a remoção?"))
                    document.getElementById('formExtratos').submit();
            }
        }

        $("#selecionarTodos").click(function () {
            $('input:checkbox').not(this).prop('checked', this.checked);
        });
    </script>
}