@model IEnumerable<Moneta.Application.ViewModels.ExtratoBancarioViewModel>

@{
    ViewBag.Title = "Extrato Bancário";
}

<h2>@ViewBag.Title</h2>

<p>
    <a class="btn btn-default" title="Importar OFX"
       href="@Url.Action("ImportarOfx", "ExtratosBancarios")">
        <i class="icon-white glyphicon glyphicon-import"></i>
    </a>

    <a id="botaoRemoverSelecionados" class="btn btn-default" title="Remover itens selecionados"
       href="javascript:validarSeExisteSelecionados()">
        <i class="icon-white glyphicon glyphicon-trash"></i>
    </a>
</p>

@using (Html.BeginForm("Index", "Contas", new {pesquisa = ""}, FormMethod.Get))
{
    <p>
        Pesquisar por Descrição: @Html.Editor("pesquisa") <input type="submit" value="Pesquisar" class="btn btn-default" />
    </p>
}

@using (Html.BeginForm("RemoverSelecionados", "ExtratosBancarios", FormMethod.Post, new { id = "formExtratos" }))
{
    @Html.AntiForgeryToken()
    
    <table class="table table-striped table-condensed">
        <tr>
            <th>
                @Html.CheckBox("selecionarTodos", false, new { @title = "Selecionar todos" })
            </th>
            <th>
                @Html.DisplayNameFor(model => model.DataCompensacao)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Descricao)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.NumeroDocumento)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Valor)
            </th>
            <th>
                Ações
            </th>
        </tr>

        @for (var i = 0; i < Model.Count(); i++)
        {
            <tr>
                <td>
                    @Html.CheckBoxFor(x => x.ElementAt(i).Selecionado)
                    @Html.HiddenFor(x => x.ElementAt(i).ExtratoBancarioId)
                </td>
                <td>
                    @Html.DisplayFor(x => x.ElementAt(i).DataCompensacao)
                    @Html.HiddenFor(x => x.ElementAt(i).DataCompensacao)
                </td>
                <td>
                    @Html.DisplayFor(x => x.ElementAt(i).Descricao)
                    @Html.HiddenFor(x => x.ElementAt(i).Descricao)
                </td>
                <td>
                    @Html.DisplayFor(x => x.ElementAt(i).NumeroDocumento)
                    @Html.HiddenFor(x => x.ElementAt(i).NumeroDocumento)
                </td>
                <td>
                    @if (Model.ElementAt(i).Valor > 0)
                    {
                        <span style="color:green">
                            @Html.DisplayFor(x => x.ElementAt(i).Valor)
                        </span>
                    }
                    else
                    {
                        <span style="color:red">
                            @Html.DisplayFor(x => x.ElementAt(i).Valor)
                        </span>
                    }               
                </td>
                <td>
                    <a title="Conciliar com um lançamento"
                       href="@Url.Action("Conciliar", "ExtratosBancarios", new { id = Model.ElementAt(i).ExtratoBancarioId })">
                        <i class="icon-white glyphicon glyphicon-new-window"></i>
                    </a>
                    <a title="Remover extrato" onclick="return confirm('Tem certeza que deseja remover?')"
                       href="@Url.Action("Delete", "ExtratosBancarios", new { id = Model.ElementAt(i).ExtratoBancarioId })">
                        <i class="icon-white glyphicon glyphicon-trash"></i>
                    </a>
                </td>
            </tr>
        }
    </table>
}

@section Scripts {
    <script type="text/javascript">
        $(function () {
            $("#formExtratos").submit(function (event) {
                alert("teste");
                validarSeExisteSelecionados();
            });
        });

        function validarSeExisteSelecionados()
        {
            var numberChecked = $('input:checkbox:checked').length;
            if (numberChecked == 0)
            {
                alert("Selecione pelo menos um item");
            }
            else
            {
                document.getElementById('formExtratos').submit();
            }
        }

        $("#selecionarTodos").click(function () {
            $('input:checkbox').not(this).prop('checked', this.checked);
        });
    </script>
}